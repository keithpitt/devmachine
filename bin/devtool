#!/usr/bin/env bash

export DEVMACHINE_PATH=$(realpath "$(dirname "$0")/..")

source "$DEVMACHINE_PATH/lib/os.sh"
source "$DEVMACHINE_PATH/lib/cache.sh"
source "$DEVMACHINE_PATH/lib/ui.sh"

bin_name="${0##*/}"
tool_path="$1"

if [[ "$tool_path" == "" ]]; then
  echo "no tool passed"
  exit 1
elif [[ "${tool_path:1:1}" == "." ]]; then
  tool_path=$(realpath "$tool_path")
else
  guess_path="$DEVMACHINE_PATH/tools/$tool_path.sh"
  if [[ -e "$guess_path" ]]; then
    tool_path="$guess_path"
  else
    echo "cant find $tool_path"
    exit 1
  fi
fi

case "$2" in
  "")
    source "$DEVMACHINE_PATH/cli/$bin_name/splash.sh" "${tool_path}"
    ;;

  *)
    source "$tool_path" "$2"
    ;;
esac
